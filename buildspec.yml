version: 0.2

env:
  variables:
    BUCKET_NAME: "bookpython"  # Replace with your bucket name
    APP_ZIP: "bookstore-api.zip"
    CFN_STACK_NAME: "bookstore"

phases:
  pre_build:
    commands:
      - echo "Setting up build environment..."
      - pip install awscli

  build:
    commands:
      - echo "Packaging Flask application..."
      - echo " list contents"
      - ls -latr
      - zip -r $APP_ZIP *

  post_build:
    commands:
      - echo "Uploading Flask app to S3..."
      - aws s3 cp $APP_ZIP s3://$BUCKET_NAME/
      - echo "Deploying CloudFormation stack..."

artifacts:
  files:
    - $APP_ZIP
